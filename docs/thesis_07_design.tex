\epigraph{\textit{The most important single aspect of sotware development is to be clear about what you are trying to build.}}{-- \textup{Bjarne Stroustrup}}

\section{Pregel and ShEx generated subsets}

\begin{algorithm}[!hbt]
    \DontPrintSemicolon
    \SetAlgoVlined
    \SetArgSty{textnormal}
    \SetKwInput{KwIn}{Input parameters}
    \KwIn{
        \Block{
            g: Graph[\VertSet, \EdgeSet] \;
            initialLabel: \LabelSet \;
            checkLocal: (\LabelSet, \VertSet) $\rightarrow$ \Ok $\mid$ \Failed\ $\mid$ \Pending(Set[\LabelSet]) \;
            checkNeighs: (\LabelSet, Bag[(\EdgeSet, \LabelSet)], Set[(\EdgeSet, \LabelSet)]) $\rightarrow$ \Ok\ $\mid$ \Failed \;
            tripleConstraints: \LabelSet $\rightarrow$ Set[(\EdgeSet, \LabelSet)] \;
        }
        \KwOut{
            g: Graph[(\VertSet, \LabelSet\ $\mapsto$ Status), \EdgeSet]
        }
        \blockskip
        gs = mapVertices( g, $\lambda$(id, v)$\rightarrow$(id, (v, $\lambda$(v) $\rightarrow$ \Undefined)) ) \;
        gs = pregel( \Validate, gs, \vProg, sendMsg, mergeMsg ) \;
        gs = mapVertices( gs, checkUnsolved ) \;
        \Return{gs} \;
    } \;
    \DefInline{checkUnsolved(v, m)}{
        (v,m') where \;
        \ \ \ m'(\lbl) = $\begin{cases}
                \text{checkNeighs(\lbl, $\emptyset$, $\emptyset$)} & \text{if}\ m(\lbl)=\Pending                   \\
                \text{checkNeighs(\lbl, oks, fs $\cup{}$ ds)}      & \text{if}\ m(\lbl)=\WaitingFor{ds}{oks}{fs}\} \\
                m(\lbl)                                            & \text{otherwise}
            \end{cases}$
    }\\
    \DefInline{vProg(Id, \VertSet, \MsgSet)$\rightarrow$\VertSet}{... see~\ref{}}
    \caption{Pregel-based ShEx validation pseudo-code~\cite{https://doi.org/10.48550/arxiv.2110.11709}}
    \label{alogorithm:PSchema}
\end{algorithm}

\begin{figure}[ht]
    \centering
    \includestandalone{diagrams/4-1_pregelState}
    \caption[State diagram representing the different states in \texttt{vProg}]{State diagram representing the different states in \texttt{vProg}~\cite{https://doi.org/10.48550/arxiv.2110.11709}}
    \label{fig:pregelState}
\end{figure}

\section{Pregel and ShEx example}